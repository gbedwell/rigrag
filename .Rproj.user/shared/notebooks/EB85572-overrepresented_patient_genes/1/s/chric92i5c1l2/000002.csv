"0","chronic.rigs.overlap <- chronic.int.counts %>%"
"0","  dplyr::full_join(., rigs.int.counts, by=""gene.name"") %>%"
"0","  tidyr::drop_na() %>%"
"0","  dplyr::mutate(fold.change = avg.frac.x/avg.frac.y,"
"0","                z.score = (avg.frac.x-avg.frac.y)/sd.frac.y,"
"0","                p.from.z = pnorm(z.score, lower.tail=FALSE, log.p = FALSE),"
"0","                q.value = p.adjust(p.from.z, method = ""BH"", n = length(p.from.z))) %>%"
"0","  dplyr::select(gene.name,  fold.change, z.score, p.from.z, q.value,"
"0","                avg.frac.x, sd.frac.x, gene.length.x, cso.x) %>%"
"0","  dplyr::arrange(gene.name) %>%"
"0","  dplyr::mutate(index = row_number())"
"0","colnames(chronic.rigs.overlap) <- c(""gene.name"",""fold.change"",""z.score"",""p.from.z"",""q.value"","
"0","                                    ""avg.frac"",""sd.frac"",""gene.length"",""cso"", ""index"")"
"0","chronic.rigs.overlap.uw <- as.numeric(base::summary(chronic.rigs.overlap$z.score)[5]) +"
"0","  (1.5*(IQR(chronic.rigs.overlap$z.score)))/nrow(chronic.rigs.overlap)"
"0","chronic.rigs.overlap.filter <- chronic.rigs.overlap %>%"
"0","  dplyr::filter(z.score >= 10)"
"0","chronic.rigs.overlap.plot <- ggplot(chronic.rigs.overlap, aes(x=index, y=-log10(q.value), fill=as.character(cso))) +"
"0","  geom_point(size=3, shape=21) +"
"0","  geom_label_repel(data=chronic.rigs.overlap.filter, aes(label=gene.name), "
"0","                   box.padding = 1, force=1, alpha=1, segment.alpha=1,"
"0","                   nudge_x = 0, nudge_y = 0.005) +"
"0","  scale_fill_brewer(palette = ""Blues"") +"
"0","  theme_bw() + theme(axis.text=element_text(size=14),"
"0","                     axis.title=element_text(size=16), "
"0","                     legend.position = ""none"", strip.text.y = element_text(size = 12),"
"0","                     plot.title = element_text(size=12, face=""bold"")) +"
"0","  scale_x_continuous(limits=c(0,800),"
"0","                     breaks=c(0,200,400,600,800)) +"
"0","  scale_y_continuous(limits=c(-50,200),"
"0","                     breaks=c(-50,0,50,100,150,200)) +"
"0","  labs(x = ""Gene Index (Alphabetical Order)"", title=""Chronic RIG-matched Genes"") +"
"0","  ylab(expression(-log[10](""q-value"")))"
"0","#chronic.rigs.overlap.plot"
"0","acute.rigs.overlap <- acute.int.counts %>%"
"0","  dplyr::full_join(., rigs.int.counts, by=""gene.name"") %>%"
"0","  tidyr::drop_na() %>%"
"0","  dplyr::mutate(fold.change = avg.frac.x/avg.frac.y,"
"0","                z.score = (avg.frac.x-avg.frac.y)/sd.frac.y,"
"0","                p.from.z = pnorm(z.score, lower.tail=FALSE, log.p = FALSE),"
"0","                q.value = p.adjust(p.from.z, method = ""BH"", n = length(p.from.z))) %>%"
"0","  dplyr::select(gene.name,  fold.change, z.score, p.from.z, q.value,"
"0","                avg.frac.x, sd.frac.x, gene.length.x, cso.x) %>%"
"0","  dplyr::arrange(gene.name) %>%"
"0","  dplyr::mutate(index = row_number())"
"0","colnames(acute.rigs.overlap) <- c(""gene.name"",""fold.change"",""z.score"",""p.from.z"",""q.value"","
"0","                                    ""avg.frac"",""sd.frac"",""gene.length"",""cso"", ""index"")"
"0","acute.rigs.overlap.filter <- acute.rigs.overlap %>%"
"0","  dplyr::filter(z.score >= 10)"
"0","acute.rigs.overlap.plot <- ggplot(acute.rigs.overlap, aes(x=index, y=-log10(q.value), fill=as.character(cso))) +"
"0","  geom_point(size=3, shape=21) +"
"0","  geom_label_repel(data=acute.rigs.overlap.filter, aes(label=gene.name), "
"0","                   box.padding = 1, force=1, alpha=1, segment.alpha=1,"
"0","                   nudge_x = 0, nudge_y = 0.005) +  "
"0","  scale_fill_brewer(palette = ""Blues"") +"
"0","  theme_bw() + theme(axis.text=element_text(size=14),"
"0","                     axis.title=element_text(size=16), "
"0","                     legend.position = ""none"", strip.text.y = element_text(size = 12),"
"0","                     plot.title = element_text(size=12, face=""bold"")) +"
"0","  scale_x_continuous(limits=c(0,1400),"
"0","                     breaks=c(0,200,400,600,800,1000,1200,1400)) +"
"0","  scale_y_continuous(limits=c(-50,200),"
"0","                     breaks=c(-50,0,50,100,150,200)) +"
"0","  labs(x = ""Gene Index (Alphabetical Order)"", title=""Acute RIG-matched Genes"") +"
"0","  ylab(expression(-log[10](""q-value"")))"
"0","#acute.rigs.overlap.plot"
"0","patient.rigs.overlap.outliers <- data.frame("
"0","  infection=c(""chronic"",""chronic"",""acute"",""acute""),"
"0","  type=c(""outliers"",""non.outliers"",""outliers"",""non.outliers""),"
"0","  fraction=c(nrow(chronic.rigs.overlap %>% dplyr::filter(z.score >= chronic.rigs.overlap.uw))/nrow(chronic.rigs.overlap),"
"0","             nrow(chronic.rigs.overlap %>% dplyr::filter(z.score < chronic.rigs.overlap.uw))/nrow(chronic.rigs.overlap),"
"0","             nrow(acute.rigs.overlap %>% dplyr::filter(z.score >= chronic.rigs.overlap.uw))/nrow(acute.rigs.overlap),"
"0","             nrow(acute.rigs.overlap %>% dplyr::filter(z.score < chronic.rigs.overlap.uw))/nrow(acute.rigs.overlap)))"
"0","patient.rigs.overlap.outliers$type <- factor(patient.rigs.overlap.outliers$type,"
"0","                                             levels = c(""outliers"",""non.outliers""))"
"0","outliers.plot <- ggplot(patient.rigs.overlap.outliers, aes(x=infection, y=fraction, fill=type)) +"
"0","  geom_bar(stat=""identity"", color = ""black"", width = 0.6) +"
"0","  scale_fill_manual(""RIG Matched Genes"","
"0","                    labels = c(""z â‰¥ UW "", ""z < UW ""),"
"0","                    values = c(""#08519C"", ""#C6DBEF""),"
"0","                    guide = guide_legend(reverse = FALSE,"
"0","                                         title.position = ""top"","
"0","                                         nrow = 1,"
"0","                                         title.hjust=0.5)) +"
"0","  theme_bw() + theme(panel.grid.major.x=element_blank(),"
"0","                     panel.grid.minor.x=element_blank(),"
"0","                     text=element_text(size=12),"
"0","                     legend.position=""top"","
"0","                     legend.key.size = unit(0.5, ""cm""),"
"0","                     legend.key.width = unit(0.5,""cm""),"
"0","                     legend.text = element_text(size=12),"
"0","                     legend.title=element_text(size=14),"
"0","                     legend.box.margin=margin(-10,-10,-10,-10),"
"0","                     axis.text=element_text(size=14),"
"0","                     axis.title=element_text(size=16)) +"
"0","  scale_x_discrete(labels = c(""Acute"", ""Chronic"")) +"
"0","  scale_y_continuous(breaks=c(0,0.25,0.5,0.75,1)) +"
"0","  labs(x = ""Patient Infection"", y = ""Fraction of Genes"")"
"0","#outliers.plot"
"0","write.table(chronic.rigs.overlap %>% dplyr::filter(z.score >= chronic.rigs.overlap.uw) %>% "
"0","              dplyr::select(gene.name, z.score, q.value, cso), "
"0","            file=paste0(getwd(), ""/hg_annotations/sample_data/chronic_rigs_overlap_zscores.txt""),"
"0","            sep=""\t"",row.names=FALSE, quote=FALSE, col.names = TRUE)"
"0","write.table(acute.rigs.overlap %>% dplyr::filter(z.score >= chronic.rigs.overlap.uw) %>% "
"0","              dplyr::select(gene.name, z.score, q.value, cso), "
"0","            file=paste0(getwd(), ""/hg_annotations/sample_data/acute_rigs_overlap_zscores.txt""),"
"0","            sep=""\t"",row.names=FALSE, quote=FALSE, col.names = TRUE)"
